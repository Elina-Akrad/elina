<!DOCTYPE html>
<!-- saved from url=(0036)https://dwid.digiwise.ir/iframe.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <script type="module">
      let parentHostname = null;
      let fp_dwid = null;

      window.addEventListener('message', function(event) {
        if (event.data && event.data.type === 'SET_PARENT_HOST') {
          parentHostname = event.data.hostname;
          fp_dwid = event.data.fp_dwid;
          
          if (fp_dwid) {
            checkOrCreateDauid();
          }
        }
      });

      function generateUUIDv7() {
        const timestamp = Date.now();
        
        const randomBytes = new Uint32Array(4);
        crypto.getRandomValues(randomBytes);
        const unixTsMs = timestamp;
        const randA = randomBytes[0] & 0xfff;
        const randBHi = randomBytes[1] & 0x3fffffff;
        const randBLo = randomBytes[2];
        const bytes = new Uint8Array(16);
        bytes[0] = (unixTsMs >>> 40) & 0xff;
        bytes[1] = (unixTsMs >>> 32) & 0xff;
        bytes[2] = (unixTsMs >>> 24) & 0xff;
        bytes[3] = (unixTsMs >>> 16) & 0xff;
        bytes[4] = (unixTsMs >>> 8) & 0xff;
        bytes[5] = unixTsMs & 0xff;
        bytes[6] = 0x70 | ((randA >>> 8) & 0x0f);
        bytes[7] = randA & 0xff;
        bytes[8] = 0x80 | ((randBHi >>> 24) & 0x3f);
        bytes[9] = (randBHi >>> 16) & 0xff;
        bytes[10] = (randBHi >>> 8) & 0xff;
        bytes[11] = randBHi & 0xff;
        bytes[12] = (randBLo >>> 24) & 0xff;
        bytes[13] = (randBLo >>> 16) & 0xff;
        bytes[14] = (randBLo >>> 8) & 0xff;
        bytes[15] = randBLo & 0xff;
        const hex = Array.from(bytes)
          .map(b => b.toString(16).padStart(2, '0'))
          .join('');
        return [
          hex.substring(0, 8),
          hex.substring(8, 12),
          hex.substring(12, 16),
          hex.substring(16, 20),
          hex.substring(20, 32)
        ].join('-');
      }
      function getOrCreateThirdPartyDwid() {
        const cookieName = 'third_dwid';
        const existingDwid = getCookie(cookieName);
        if (existingDwid) {
          return existingDwid;
        }  
        let newDwid;
        newDwid = generateUUIDv7();
        setThirdPartyCookie(cookieName, newDwid, 30);
        
        return newDwid;
      }

      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) {
          const cookieValue = parts.pop().split(';').shift();
          return cookieValue;
        }
        return null;
      }

      function setCookie(name, value, days = 365) {
        const expires = new Date();
        expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
        document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/;domain=.digiwise.ir;Secure;SameSite=None`;
      }

      function setThirdPartyCookie(name, value, days = 365) {
        const expires = new Date();
        expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
        
        const currentDomain = window.location.hostname;
        const isSecure = window.location.protocol === 'https:';
        
        let cookieString = `${name}=${value};domain=.digiwise.ir;expires=${expires.toUTCString()};path=/;domain=.digiwise.ir`;
        
        if (isSecure) {
          cookieString += ';Secure';
        }
        
        cookieString += ';SameSite=None';
                
        try {
          document.cookie = cookieString;
          
          const testCookie = getCookie(name);
        } catch (e) {
        }
      }

      async function checkOrCreateDauid() {
        let _dwid = getCookie('_dwid');
        const requestSuccess = getCookie('_dwid_request_success');
        const thirdPartyDwid = getOrCreateThirdPartyDwid();
        if (!_dwid || !requestSuccess || requestSuccess === 'false') {
          if (!fp_dwid) {
            return null; 
          }

          try {
            
            setCookie('_dwid', thirdPartyDwid, 30);

            const bodyData = {
              fingerprint: fp_dwid,
              cookie:  thirdPartyDwid,
              source: 'IFRAME',
              sdk_version: '2.0.9',
              device_detail: {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                cookies_enabled: navigator.cookieEnabled,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                content_language: navigator.language,
                product: navigator.product,
                product_sub: navigator.productSub,
                vendor: navigator.vendor,
                vendor_sub: navigator.vendorSub,
                hardware_concurrency: navigator.hardwareConcurrency,
                device_memory: navigator.deviceMemory || 0,
                plugins: navigator.plugins.length,
                screen_width: window.screen.width,
                screen_height: window.screen.height,
                screen_depth: window.screen.colorDepth,
                screen_available_top: window.screen.availTop || 0,
                screen_available_left: window.screen.availLeft || 0,
                screen_available_height: window.screen.availHeight,
                screen_available_width: window.screen.availWidth,
                permissions: navigator.permissions ? navigator.permissions : null,
                media_devices: navigator.mediaDevices ? navigator.mediaDevices : null,
                keyboard: navigator.keyboard ? navigator.keyboard : null,
                personal_bar: window.personalbar ? window.personalbar : null,
                menu_bar: window.menubar ? window.menubar : null,
                location_bar: window.locationbar ? window.locationbar : null,
                status_bar: window.statusbar ? window.statusbar : null,
                toolbar: window.toolbar ? window.toolbar : null,
                parent_hostname: parentHostname,
              },
            };

            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 1000); 
            
            const res = await fetch(
              'https://api-dwid.digiwise.ir/api/v1/generate-new-id',
              {
                method: 'POST',
                credentials: 'include',
                headers: {
                  Accept: 'application/json',
                  'Content-Type': 'application/json',
                  Origin: parentHostname || window.parent.location.hostname,
                  'dwid-origin': parentHostname || "",
                },
                body: JSON.stringify(bodyData),
                signal: controller.signal,
              }
            );

            clearTimeout(timeoutId);

            if (res.ok) {
              setCookie('_dwid_request_success', 'true', 30);
            } else {
              setCookie('_dwid_request_success', 'false', 30);
            }

          } catch (e) {
            setCookie('_dwid_request_success', 'false', 30);
          }
        } else {
          setCookie('_dwid', _dwid, 30);
        }

        return thirdPartyDwid;
      }

      window.getDauid = async function () {
        return await checkOrCreateDauid();
      };

      window.addEventListener('message', async function (event) {
        const data = event.data;
        if (data?.type === 'checkDauid' || data?.type === 'getDauid') {
          const _dwid = await checkOrCreateDauid();
          
          if (_dwid) {
            event.source.postMessage(
              {
                type: 'DauidResponse',
                value: _dwid,
              },
              event.origin
            );
          }
        }
      });

      checkOrCreateDauid();
    </script>
  
</body></html>